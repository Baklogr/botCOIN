<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HamsterTON - Cyber Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0a0a0a;
            --bg-medium: #1a1a1a;
            --bg-light: #2a2a2a;
            --text-color: #e0f2f7; /* Світло-блакитний для тексту */
            --accent-neon-blue: #00ffff; /* Яскравий неоновий синій */
            --accent-neon-green: #00ff00; /* Яскравий неоновий зелений */
            --accent-neon-purple: #ff00ff; /* Яскравий неоновий фіолетовий */
            --border-color: #00ffff;
            --glow-strength: 0 0 10px var(--accent-neon-blue), 0 0 20px var(--accent-neon-blue);
        }

        body {
            font-family: 'Share Tech Mono', monospace; /* Моноширинний для тексту */
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            min-height: 100vh;
            background-color: var(--bg-dark);
            color: var(--text-color);
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        header {
            width: 100%;
            padding: 15px 0;
            text-align: center;
            background-color: var(--bg-medium);
            box-shadow: var(--glow-strength);
            z-index: 10;
            flex-shrink: 0;
            border-bottom: 2px solid var(--border-color);
        }

        #balance-container {
            font-family: 'Orbitron', sans-serif; /* Футуристичний для балансу */
            font-size: 2.8em;
            font-weight: 700;
            color: var(--accent-neon-green);
            text-shadow: var(--glow-strength);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
        }

        #coin-icon-header {
            width: 45px;
            height: 45px;
            vertical-align: middle;
            margin-right: 10px;
            object-fit: contain;
            filter: drop-shadow(0 0 8px var(--accent-neon-green));
        }
        
        #profit-per-hour {
            font-size: 1.1em;
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 0 0 5px rgba(0,255,255,0.5);
        }
        #profit-per-hour .icon {
            margin-right: 8px;
            font-size: 1.2em;
            color: var(--accent-neon-purple);
        }

        main {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            width: 100%;
            position: relative;
            padding: 20px 0;
            box-sizing: border-box;
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        main::-webkit-scrollbar {
            display: none;
        }

        /* Стилі для секції Тапу */
        #tap-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-bottom: 25px;
        }

        #tap-area {
            width: 300px;
            height: 300px;
            background: radial-gradient(circle at center, var(--bg-medium) 0%, var(--bg-dark) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--glow-strength);
            transition: transform 0.1s ease-out, box-shadow 0.2s ease-out;
            position: relative;
            overflow: hidden;
            border: 3px solid var(--border-color);
        }

        #tap-area:active {
            transform: scale(0.92);
            box-shadow: 0 0 5px var(--accent-neon-blue), 0 0 15px var(--accent-neon-blue), 0 0 25px var(--accent-neon-blue);
        }

        #ton-coin-image {
            width: 85%;
            height: 85%;
            object-fit: contain;
            filter: drop-shadow(0 0 10px var(--accent-neon-blue));
            transition: transform 0.1s ease-out;
        }

        .click-animation {
            position: absolute;
            font-family: 'Orbitron', sans-serif;
            font-size: 2.2em;
            opacity: 0;
            animation: fadeOutUp 1s forwards;
            pointer-events: none;
            color: var(--accent-neon-green);
            text-shadow: var(--glow-strength);
            font-weight: bold;
            z-index: 100;
        }

        @keyframes fadeOutUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-80px); opacity: 0; }
        }

        #energy-bar-container {
            width: 90%;
            max-width: 320px;
            background-color: #333;
            border-radius: 12px;
            height: 25px;
            margin-top: 25px;
            overflow: hidden;
            box-shadow: inset 0 0 8px rgba(0,0,0,0.6);
            border: 1px solid var(--border-color);
        }

        #energy-bar {
            height: 100%;
            width: 100%;
            background: linear-gradient(to right, var(--accent-neon-green), #00cc66);
            border-radius: 12px;
            transition: width 0.2s linear;
        }

        #energy-text {
            text-align: center;
            margin-top: 10px;
            font-size: 1em;
            color: var(--text-color);
            text-shadow: 0 0 5px rgba(0,255,0,0.5);
        }

        /* Загальні стилі для секцій контенту */
        .content-section {
            width: 90%;
            max-width: 480px;
            background-color: var(--bg-medium);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: var(--glow-strength);
            display: none;
            flex-direction: column;
            gap: 18px;
            box-sizing: border-box;
            border: 1px solid var(--border-color);
        }
        .content-section.active {
            display: flex;
        }

        .section-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2em;
            font-weight: 700;
            text-align: center;
            margin-bottom: 25px;
            color: var(--accent-neon-blue);
            text-shadow: var(--glow-strength);
        }

        /* Стилі для елементів апгрейду */
        .upgrade-item {
            display: flex;
            align-items: center;
            background-color: var(--bg-dark);
            padding: 15px 25px;
            border-radius: 12px;
            transition: background-color 0.2s;
            cursor: pointer;
            box-shadow: 0 0 8px rgba(0,255,255,0.3);
            border: 1px solid rgba(0,255,255,0.5);
        }
        .upgrade-item:hover:not(.disabled) {
            background-color: #202020;
            box-shadow: 0 0 15px var(--accent-neon-blue);
        }
        .upgrade-item.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #050505;
            border-color: #101010;
            box-shadow: none;
        }

        .upgrade-icon {
            font-size: 3em;
            margin-right: 25px;
            color: var(--accent-neon-purple);
            text-shadow: 0 0 8px var(--accent-neon-purple);
        }

        .upgrade-info {
            flex-grow: 1;
        }
        .upgrade-name {
            font-size: 1.3em;
            font-weight: 700;
            color: var(--text-color);
            text-shadow: 0 0 5px rgba(255,255,255,0.5);
        }
        .upgrade-cost {
            font-size: 1.1em;
            color: var(--text-color);
            margin-top: 8px;
            display: flex;
            align-items: center;
        }
        .upgrade-cost .icon {
            margin-right: 10px;
            font-size: 1.3em;
            color: var(--accent-neon-green);
            text-shadow: 0 0 5px var(--accent-neon-green);
        }
        .upgrade-profit {
            font-size: 1em;
            color: var(--accent-neon-green);
            margin-top: 5px;
            font-weight: 500;
            text-shadow: 0 0 5px var(--accent-neon-green);
        }

        /* Стилі для нижньої навігаційної панелі (ВИПРАВЛЕНО) */
        .controls {
            width: 100%;
            padding: 10px 0; /* Зменшуємо відступи */
            display: flex;
            justify-content: space-around;
            background-color: var(--bg-medium);
            box-shadow: var(--glow-strength);
            z-index: 10;
            flex-shrink: 0;
            border-top: 2px solid var(--border-color);
            box-sizing: border-box; /* Важливо для коректного розрахунку ширини */
        }

        .control-button {
            background-color: transparent;
            color: var(--text-color);
            border: none;
            padding: 5px 0; /* Зменшуємо вертикальні відступи */
            border-radius: 8px; /* Трохи менший радіус */
            font-size: 0.85em; /* Зменшуємо розмір шрифту */
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s, color 0.2s, text-shadow 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            flex: 1; /* Дозволяє кнопкам займати рівний простір */
            max-width: 80px; /* Обмежуємо максимальну ширину кнопки */
            text-shadow: 0 0 3px rgba(255,255,255,0.3);
            white-space: nowrap; /* Запобігаємо перенесенню тексту */
            overflow: hidden; /* Обрізаємо, якщо текст все ж не вміщається */
            text-overflow: ellipsis; /* Додаємо три крапки, якщо текст обрізано */
        }

        .control-button.active {
            background-color: var(--bg-dark);
            color: var(--accent-neon-blue);
            transform: translateY(-3px); /* Трохи менший підйом */
            text-shadow: var(--glow-strength);
            border: 1px solid var(--accent-neon-blue);
        }

        .control-button:hover:not(.active) {
            background-color: #202020;
            color: var(--accent-neon-green);
            text-shadow: 0 0 6px var(--accent-neon-green);
        }

        .control-button:active {
            transform: scale(0.9); /* Трохи сильніше стискання */
        }

        .button-icon {
            font-size: 1.6em; /* Зменшуємо розмір іконки */
            margin-bottom: 5px; /* Зменшуємо відступ під іконкою */
        }
        
        /* Стилі для Boost секції */
        #boost-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 25px;
            box-sizing: border-box;
        }

        .boost-item {
            background-color: var(--bg-dark);
            padding: 20px;
            border-radius: 12px;
            width: 100%;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            box-shadow: 0 0 8px rgba(0,255,255,0.3);
            border: 1px solid rgba(0,255,255,0.5);
        }

        .boost-item .boost-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.4em;
            font-weight: 700;
            color: var(--accent-neon-blue);
            text-shadow: var(--glow-strength);
        }

        .boost-item .boost-desc {
            font-size: 1em;
            color: var(--text-color);
            text-align: center;
            text-shadow: 0 0 5px rgba(255,255,255,0.2);
        }

        .boost-button {
            background-color: var(--accent-neon-green);
            color: var(--bg-dark);
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
            width: 90%;
            max-width: 280px;
            font-weight: 700;
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
            box-shadow: 0 0 10px var(--accent-neon-green);
        }

        .boost-button:hover:not(:disabled) {
            background-color: #00e600;
            transform: translateY(-2px);
            box-shadow: 0 0 15px var(--accent-neon-green);
        }
        .boost-button:disabled {
            background-color: #444;
            cursor: not-allowed;
            box-shadow: none;
            color: #888;
            text-shadow: none;
        }

        /* Стилі для повідомлень-поп-апів */
        .popup-message {
            position: fixed;
            bottom: 140px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.9);
            color: var(--accent-neon-blue);
            padding: 15px 30px;
            border-radius: 12px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
            z-index: 1000;
            font-size: 1.2em;
            font-weight: 700;
            text-shadow: var(--glow-strength);
            box-shadow: var(--glow-strength);
        }
        .popup-message.show {
            opacity: 1;
            visibility: visible;
        }

        /* Стилі для секції статистики */
        #stats-section p {
            font-size: 1.1em;
            margin-bottom: 10px;
            color: var(--text-color);
        }
        #stats-section p span {
            font-weight: 700;
            color: var(--accent-neon-green);
            margin-left: 8px;
            text-shadow: 0 0 5px var(--accent-neon-green);
        }

        /* Стилі для секцій друзів та Airdrop (заглушки) */
        #friends-section, #airdrop-section {
            text-align: center;
        }
        #friends-section p, #airdrop-section p {
            margin-bottom: 25px;
            color: var(--text-color);
            text-shadow: 0 0 3px rgba(255,255,255,0.2);
        }
        #airdrop-section ul {
            list-style: none;
            padding: 0;
            margin-bottom: 25px;
        }
        #airdrop-section li {
            background-color: var(--bg-dark);
            margin-bottom: 10px;
            padding: 12px;
            border-radius: 10px;
            font-size: 1.1em;
            color: var(--accent-neon-purple);
            box-shadow: 0 0 5px var(--accent-neon-purple);
            border: 1px solid rgba(255,0,255,0.5);
        }
    </style>
</head>
<body>
    <header>
        <div id="balance-container">
            <img id="coin-icon-header" src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/Ton_blockchain_logo.svg/1200px-Ton_blockchain_logo.svg.png" alt="TON Coin">
            <span id="coin-balance">0</span>
        </div>
        <div id="profit-per-hour">
            <span class="icon">📈</span>
            <span id="profit-value">0</span> / год
        </div>
    </header>

    <main>
        <section id="tap-section" class="content-section active">
            <div id="tap-area">
                <img id="ton-coin-image" src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/Ton_blockchain_logo.svg/1200px-Ton_blockchain_logo.svg.png" alt="TON Coin">
            </div>
            <div id="energy-bar-container">
                <div id="energy-bar"></div>
            </div>
            <div id="energy-text"><span id="current-energy">0</span> / <span id="max-energy">0</span></div>
        </section>

        <section id="mine-section" class="content-section">
            <div class="section-title">CYBER MINES</div>
            <div id="upgrades-list">
                </div>
        </section>

        <section id="boost-section" class="content-section">
            <div class="section-title">SYSTEM BOOSTS</div>
            <div class="boost-item">
                <div class="boost-title">FULL ENERGY RECHARGE</div>
                <div class="boost-desc">Instantly restores all system energy.</div>
                <button class="boost-button" id="full-energy-boost">
                    RECHARGE (<span id="full-energy-boost-count">3</span>/3 per cycle)
                </button>
            </div>
            <div class="boost-item">
                <div class="boost-title">MULTITAP PROTOCOL</div>
                <div class="boost-desc">Doubles click output for 60 seconds.</div>
                <button class="boost-button" id="multitap-boost">
                    ACTIVATE (<span id="multitap-boost-count">3</span>/3 per cycle)
                </button>
            </div>
            <div class="boost-item">
                <div class="boost-title">ENERGY CORE OVERLOAD</div>
                <div class="boost-desc">Temporarily increases max energy by 500 units.</div>
                <button class="boost-button" id="energy-limit-boost">
                    OVERLOAD (<span id="energy-limit-boost-count">3</span>/3 per cycle)
                </button>
            </div>
        </section>

        <section id="stats-section" class="content-section">
            <div class="section-title">DATA LOGS</div>
            <p>Total Balance: <span id="stats-balance">0</span> 💎</p>
            <p>Click Output: <span id="stats-tap-power">1</span> 💎</p>
            <p>Hourly Yield: <span id="stats-profit-hour">0</span> 💎</p>
            <p>Current Energy: <span id="stats-energy">0</span> / <span id="stats-max-energy">0</span></p>
            <p>Recharge Boosts Used: <span id="stats-full-energy-used">0</span></p>
            <p>Multitap Protocols Activated: <span id="stats-multitap-used">0</span></p>
            <p>Core Overloads Initiated: <span id="stats-energy-limit-used">0</span></p>
        </section>

        <section id="friends-section" class="content-section">
            <div class="section-title">NETWORK ACCESS</div>
            <p>Invite fellow operatives and expand your network for bonus rewards. (Feature in development)</p>
            <button class="boost-button" style="background-color: var(--accent-neon-purple);">INITIATE INVITE</button>
        </section>

        <section id="airdrop-section" class="content-section">
            <div class="section-title">AIRDROP PROTOCOLS</div>
            <p>Complete data bounties to earn additional TON units! (Feature in development)</p>
            <ul>
                <li>Engage with X-Channel (+1000 💎)</li>
                <li>Join Y-Group (+500 💎)</li>
            </ul>
            <button class="boost-button" style="background-color: #ff8c00;">EXECUTE BOUNTY</button>
        </section>

    </main>

    <div class="controls">
        <a href="#tap" class="control-button active" data-section="tap-section"><span class="button-icon">⚡</span><span>TAP</span></a>
        <a href="#mine" class="control-button" data-section="mine-section"><span class="button-icon">⚙️</span><span>MINES</span></a>
        <a href="#boost" class="control-button" data-section="boost-section"><span class="button-icon">🚀</span><span>BOOSTS</span></a>
        <a href="#stats" class="control-button" data-section="stats-section"><span class="button-icon">📊</span><span>DATA</span></a>
        <a href="#friends" class="control-button" data-section="friends-section"><span class="button-icon">🌐</span><span>NETWORK</span></a>
        <a href="#airdrop" class="control-button" data-section="airdrop-section"><span class="button-icon">📦</span><span>AIRDROP</span></a>
    </div>

    <div id="popup-message" class="popup-message"></div>

    <script>
        const STORAGE_KEY = 'hamsterClickerGameDataCyberEdition'; // Змінюємо ключ сховища для нового дизайну

        const coinBalanceDisplay = document.getElementById('coin-balance');
        const profitValueDisplay = document.getElementById('profit-value');
        const tapArea = document.getElementById('tap-area');
        const energyBar = document.getElementById('energy-bar');
        const currentEnergyDisplay = document.getElementById('current-energy');
        const maxEnergyDisplay = document.getElementById('max-energy');
        const upgradesList = document.getElementById('upgrades-list');
        const popupMessage = document.getElementById('popup-message');

        // Boost елементи
        const fullEnergyBoostBtn = document.getElementById('full-energy-boost');
        const fullEnergyBoostCountDisplay = document.getElementById('full-energy-boost-count');
        const multitapBoostBtn = document.getElementById('multitap-boost');
        const multitapBoostCountDisplay = document.getElementById('multitap-boost-count');
        const energyLimitBoostBtn = document.getElementById('energy-limit-boost');
        const energyLimitBoostCountDisplay = document.getElementById('energy-limit-boost-count');

        // Stats елементи
        const statsBalance = document.getElementById('stats-balance');
        const statsTapPower = document.getElementById('stats-tap-power');
        const statsProfitHour = document.getElementById('stats-profit-hour');
        const statsEnergy = document.getElementById('stats-energy');
        const statsMaxEnergy = document.getElementById('stats-max-energy');
        const statsFullEnergyUsed = document.getElementById('stats-full-energy-used');
        const statsMultitapUsed = document.getElementById('stats-multitap-used');
        const statsEnergyLimitUsed = document.getElementById('stats-energy-limit-used');

        let gameState = {
            coinBalance: 0,
            tapPower: 1, // Дохід за 1 клік
            profitPerHour: 0, // Пасивний дохід за годину
            currentEnergy: 500,
            maxEnergy: 500,
            energyRecoveryRate: 3, // Енергії відновлюється за секунду
            upgrades: {
                // 'id': { level: 0, cost: initialCost, profit: initialProfit, tapPower: initialTapPower }
            },
            boosts: {
                fullEnergy: { count: 3, dailyLimit: 3, usedToday: 0, lastUsedDate: null },
                multitap: { count: 3, dailyLimit: 3, usedToday: 0, lastUsedDate: null, isActive: false, timer: null },
                energyLimit: { count: 3, dailyLimit: 3, usedToday: 0, lastUsedDate: null, isActive: false, timer: null }
            },
            stats: {
                fullEnergyUsed: 0,
                multitapUsed: 0,
                energyLimitUsed: 0
            },
            lastActiveTime: Date.now() // Для розрахунку офлайн-доходу
        };

        // Визначення апгрейдів (тут можна додати більше)
        const allUpgrades = [
            { id: 'exchange_tier_1', name: 'Quantum Exchange Node', icon: '🏦', baseCost: 100, costMultiplier: 1.5, baseProfit: 1, type: 'profit' },
            { id: 'mining_rig_1', name: 'Basic Data Miner', icon: '⛏️', baseCost: 500, costMultiplier: 1.6, baseProfit: 5, type: 'profit' },
            { id: 'tap_mastery_1', name: 'Neural Interface Upgrade', icon: '👆', baseCost: 1000, costMultiplier: 1.7, baseTapPower: 1, type: 'tap' },
            { id: 'marketing_campaign', name: 'Viral Protocol Injection', icon: '📢', baseCost: 2000, costMultiplier: 1.8, baseProfit: 10, type: 'profit' },
            { id: 'exchange_tier_2', name: 'Galactic Trade Hub', icon: '🏦', baseCost: 5000, costMultiplier: 1.5, baseProfit: 20, type: 'profit' },
            { id: 'mining_rig_2', name: 'Advanced Data Extractor', icon: '⛏️', baseCost: 10000, costMultiplier: 1.6, baseProfit: 50, type: 'profit' },
            { id: 'energy_upgrade', name: 'Core Energy Capacitor', icon: '⚡', baseCost: 15000, costMultiplier: 1.4, baseMaxEnergy: 200, type: 'energy' },
        ];

        function loadGameState() {
            const savedState = localStorage.getItem(STORAGE_KEY);
            if (savedState) {
                const parsedState = JSON.parse(savedState);
                // Копіюємо тільки дозволені властивості, щоб уникнути ін'єкцій або старих даних
                for (const key in gameState) {
                    if (parsedState.hasOwnProperty(key)) {
                        gameState[key] = parsedState[key];
                    }
                }
                // Конвертуємо дати назад в об'єкти Date
                if (gameState.boosts.fullEnergy.lastUsedDate) {
                    gameState.boosts.fullEnergy.lastUsedDate = new Date(gameState.boosts.fullEnergy.lastUsedDate);
                }
                if (gameState.boosts.multitap.lastUsedDate) {
                    gameState.boosts.multitap.lastUsedDate = new Date(gameState.boosts.multitap.lastUsedDate);
                }
                if (gameState.boosts.energyLimit.lastUsedDate) {
                    gameState.boosts.energyLimit.lastUsedDate = new Date(gameState.boosts.energyLimit.lastUsedDate);
                }
            }

            // Перевірка та оновлення щоденних бустів
            const today = new Date().toDateString();
            for (const boostType in gameState.boosts) {
                const boost = gameState.boosts[boostType];
                if (boost.lastUsedDate && new Date(boost.lastUsedDate).toDateString() !== today) {
                    boost.usedToday = 0;
                    boost.lastUsedDate = null;
                }
            }

            calculateOfflineProfit();
            updateDisplay();
            renderUpgrades();
            updateBoostButtons();
            updateStatsDisplay();
        }

        function saveGameState() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(gameState));
        }

        function calculateOfflineProfit() {
            const now = Date.now();
            const timeElapsedMs = now - gameState.lastActiveTime;
            const timeElapsedHours = timeElapsedMs / (1000 * 60 * 60);

            if (timeElapsedHours > 0 && gameState.profitPerHour > 0) {
                let offlineProfit = gameState.profitPerHour * timeElapsedHours;
                // Обмежимо офлайн-дохід, наприклад, 3 годинами, щоб не було занадто багато
                const maxOfflineHours = 3;
                if (timeElapsedHours > maxOfflineHours) {
                    offlineProfit = gameState.profitPerHour * maxOfflineHours;
                }
                
                gameState.coinBalance += offlineProfit;
                showPopupMessage(`Offline Data Received: +${formatNumber(offlineProfit)} 💎`);
            }
            gameState.lastActiveTime = now;
            saveGameState(); // Зберігаємо новий час активності
        }

        function updateDisplay() {
            coinBalanceDisplay.textContent = formatNumber(gameState.coinBalance);
            profitValueDisplay.textContent = formatNumber(gameState.profitPerHour);
            energyBar.style.width = (gameState.currentEnergy / gameState.maxEnergy) * 100 + '%';
            currentEnergyDisplay.textContent = Math.floor(gameState.currentEnergy);
            maxEnergyDisplay.textContent = gameState.maxEnergy;
            updateBoostButtons(); // Оновлюємо стан кнопок бустів
            updateStatsDisplay(); // Оновлюємо статистику
        }

        function formatNumber(num) {
            if (num >= 1_000_000_000_000) return (num / 1_000_000_000_000).toFixed(2) + 'T';
            if (num >= 1_000_000_000) return (num / 1_000_000_000).toFixed(2) + 'B';
            if (num >= 1_000_000) return (num / 1_000_000).toFixed(2) + 'M';
            if (num >= 1_000) return (num / 1_000).toFixed(2) + 'K';
            return Math.floor(num).toString();
        }

        function createClickAnimation(x, y, value) {
            const animationElement = document.createElement('div');
            animationElement.textContent = `+${formatNumber(value)}`;
            animationElement.classList.add('click-animation');
            // Щоб анімація з'являлася біля місця кліку
            animationElement.style.left = `${x}px`;
            animationElement.style.top = `${y}px`;
            document.body.appendChild(animationElement);

            animationElement.addEventListener('animationend', () => {
                animationElement.remove();
            });
        }

        tapArea.addEventListener('click', (e) => {
            if (gameState.currentEnergy >= gameState.tapPower) {
                gameState.coinBalance += gameState.tapPower;
                gameState.currentEnergy -= gameState.tapPower;

                updateDisplay();
                saveGameState();

                const rect = tapArea.getBoundingClientRect();
                const clickX = e.clientX;
                const clickY = e.clientY;
                createClickAnimation(clickX, clickY, gameState.tapPower);

            } else {
                showPopupMessage("INSUFFICIENT ENERGY! RECHARGE REQUIRED.");
            }
        });

        // Відновлення енергії
        setInterval(() => {
            if (gameState.currentEnergy < gameState.maxEnergy) {
                gameState.currentEnergy += (gameState.energyRecoveryRate / 10); // ділимо на 10, бо інтервал 100мс
                if (gameState.currentEnergy > gameState.maxEnergy) {
                    gameState.currentEnergy = gameState.maxEnergy;
                }
                updateDisplay();
                saveGameState();
            }
        }, 100); // Оновлюємо кожні 100 мс

        // Додавання пасивного доходу
        setInterval(() => {
            if (gameState.profitPerHour > 0) {
                // Додаємо дохід щосекунди, тому profitPerHour / 3600
                gameState.coinBalance += (gameState.profitPerHour / 3600);
                updateDisplay();
                saveGameState();
            }
        }, 1000); // Кожну секунду

        // --- Управління апгрейдами ---
        function renderUpgrades() {
            upgradesList.innerHTML = '';
            allUpgrades.forEach(upgrade => {
                const currentLevel = gameState.upgrades[upgrade.id] ? gameState.upgrades[upgrade.id].level : 0;
                const nextCost = Math.floor(upgrade.baseCost * Math.pow(upgrade.costMultiplier, currentLevel));
                
                const upgradeItem = document.createElement('div');
                upgradeItem.classList.add('upgrade-item');
                upgradeItem.dataset.id = upgrade.id;

                let profitText = '';
                if (upgrade.type === 'profit') {
                    const nextProfit = Math.floor(upgrade.baseProfit * (currentLevel + 1));
                    profitText = `<div class="upgrade-profit">+${formatNumber(nextProfit)}/HOUR</div>`;
                } else if (upgrade.type === 'tap') {
                    const nextTapPower = Math.floor(upgrade.baseTapPower * (currentLevel + 1));
                    profitText = `<div class="upgrade-profit">TAP BOOST: +${formatNumber(nextTapPower)}</div>`;
                } else if (upgrade.type === 'energy') {
                    const nextMaxEnergy = Math.floor(upgrade.baseMaxEnergy * (currentLevel + 1));
                    profitText = `<div class="upgrade-profit">MAX ENERGY: +${formatNumber(nextMaxEnergy)}</div>`;
                }

                upgradeItem.innerHTML = `
                    <div class="upgrade-icon">${upgrade.icon}</div>
                    <div class="upgrade-info">
                        <div class="upgrade-name">${upgrade.name} (LVL ${currentLevel})</div>
                        <div class="upgrade-cost">
                            <span class="icon">💎</span>${formatNumber(nextCost)}
                        </div>
                        ${profitText}
                    </div>
                `;

                if (gameState.coinBalance < nextCost) {
                    upgradeItem.classList.add('disabled');
                }

                upgradeItem.addEventListener('click', () => buyUpgrade(upgrade.id));
                upgradesList.appendChild(upgradeItem);
            });
        }

        function buyUpgrade(upgradeId) {
            const upgrade = allUpgrades.find(u => u.id === upgradeId);
            if (!upgrade) return;

            const currentLevel = gameState.upgrades[upgradeId] ? gameState.upgrades[upgradeId].level : 0;
            const nextCost = Math.floor(upgrade.baseCost * Math.pow(upgrade.costMultiplier, currentLevel));

            if (gameState.coinBalance >= nextCost) {
                gameState.coinBalance -= nextCost;
                if (!gameState.upgrades[upgradeId]) {
                    gameState.upgrades[upgradeId] = { level: 0 };
                }
                gameState.upgrades[upgradeId].level++;

                // Оновлюємо характеристики гри
                if (upgrade.type === 'profit') {
                    gameState.profitPerHour += Math.floor(upgrade.baseProfit * (currentLevel + 1));
                } else if (upgrade.type === 'tap') {
                    gameState.tapPower += Math.floor(upgrade.baseTapPower * (currentLevel + 1));
                } else if (upgrade.type === 'energy') {
                    gameState.maxEnergy += Math.floor(upgrade.baseMaxEnergy * (currentLevel + 1));
                    // Миттєво поповнюємо енергію після апгрейду ліміту
                    gameState.currentEnergy = gameState.maxEnergy; 
                }

                showPopupMessage(`UPGRADE COMPLETE: ${upgrade.name} LVL ${gameState.upgrades[upgradeId].level}!`);
                updateDisplay();
                renderUpgrades();
                saveGameState();
            } else {
                showPopupMessage("INSUFFICIENT FUNDS!");
            }
        }

        // --- Управління бустами ---
        function updateBoostButtons() {
            const today = new Date().toDateString();

            // Full Energy Boost
            if (gameState.boosts.fullEnergy.lastUsedDate && gameState.boosts.fullEnergy.lastUsedDate.toDateString() === today) {
                fullEnergyBoostCountDisplay.textContent = `${gameState.boosts.fullEnergy.dailyLimit - gameState.boosts.fullEnergy.usedToday}/${gameState.boosts.fullEnergy.dailyLimit} per cycle`;
                if (gameState.boosts.fullEnergy.usedToday >= gameState.boosts.fullEnergy.dailyLimit) {
                    fullEnergyBoostBtn.disabled = true;
                } else {
                    fullEnergyBoostBtn.disabled = false;
                }
            } else {
                gameState.boosts.fullEnergy.usedToday = 0;
                fullEnergyBoostCountDisplay.textContent = `${gameState.boosts.fullEnergy.dailyLimit - gameState.boosts.fullEnergy.usedToday}/${gameState.boosts.fullEnergy.dailyLimit} per cycle`;
                fullEnergyBoostBtn.disabled = false;
            }

            // Multitap Boost
            if (gameState.boosts.multitap.lastUsedDate && gameState.boosts.multitap.lastUsedDate.toDateString() === today) {
                multitapBoostCountDisplay.textContent = `${gameState.boosts.multitap.dailyLimit - gameState.boosts.multitap.usedToday}/${gameState.boosts.multitap.dailyLimit} per cycle`;
                if (gameState.boosts.multitap.usedToday >= gameState.boosts.multitap.dailyLimit || gameState.boosts.multitap.isActive) {
                    multitapBoostBtn.disabled = true;
                } else {
                    multitapBoostBtn.disabled = false;
                }
            } else {
                gameState.boosts.multitap.usedToday = 0;
                multitapBoostCountDisplay.textContent = `${gameState.boosts.multitap.dailyLimit - gameState.boosts.multitap.usedToday}/${gameState.boosts.multitap.dailyLimit} per cycle`;
                multitapBoostBtn.disabled = false;
            }

            // Energy Limit Boost
            if (gameState.boosts.energyLimit.lastUsedDate && gameState.boosts.energyLimit.lastUsedDate.toDateString() === today) {
                energyLimitBoostCountDisplay.textContent = `${gameState.boosts.energyLimit.dailyLimit - gameState.boosts.energyLimit.usedToday}/${gameState.boosts.energyLimit.dailyLimit} per cycle`;
                if (gameState.boosts.energyLimit.usedToday >= gameState.boosts.energyLimit.dailyLimit || gameState.boosts.energyLimit.isActive) {
                    energyLimitBoostBtn.disabled = true;
                } else {
                    energyLimitBoostBtn.disabled = false;
                }
            } else {
                gameState.boosts.energyLimit.usedToday = 0;
                energyLimitBoostCountDisplay.textContent = `${gameState.boosts.energyLimit.dailyLimit - gameState.boosts.energyLimit.usedToday}/${gameState.boosts.energyLimit.dailyLimit} per cycle`;
                energyLimitBoostBtn.disabled = false;
            }

            // Якщо multitap активний, відключити кнопку
            if (gameState.boosts.multitap.isActive) {
                multitapBoostBtn.textContent = 'ACTIVE!';
                multitapBoostBtn.disabled = true;
            } else if (gameState.boosts.multitap.usedToday < gameState.boosts.multitap.dailyLimit) {
                multitapBoostBtn.textContent = `ACTIVATE (${gameState.boosts.multitap.dailyLimit - gameState.boosts.multitap.usedToday}/${gameState.boosts.multitap.dailyLimit} per cycle)`;
            }

            // Якщо energyLimit активний, відключити кнопку
            if (gameState.boosts.energyLimit.isActive) {
                energyLimitBoostBtn.textContent = 'ACTIVE!';
                energyLimitBoostBtn.disabled = true;
            } else if (gameState.boosts.energyLimit.usedToday < gameState.boosts.energyLimit.dailyLimit) {
                energyLimitBoostBtn.textContent = `OVERLOAD (${gameState.boosts.energyLimit.dailyLimit - gameState.boosts.energyLimit.usedToday}/${gameState.boosts.energyLimit.dailyLimit} per cycle)`;
            }
        }

        fullEnergyBoostBtn.addEventListener('click', () => {
            const boost = gameState.boosts.fullEnergy;
            const today = new Date();
            if (boost.usedToday < boost.dailyLimit) {
                gameState.currentEnergy = gameState.maxEnergy;
                boost.usedToday++;
                boost.lastUsedDate = today;
                gameState.stats.fullEnergyUsed++;
                showPopupMessage("ENERGY CORE FULLY RESTORED!");
                updateDisplay();
                saveGameState();
            } else {
                showPopupMessage("DAILY RECHARGE LIMIT REACHED!");
            }
        });

        multitapBoostBtn.addEventListener('click', () => {
            const boost = gameState.boosts.multitap;
            const today = new Date();
            if (boost.usedToday < boost.dailyLimit && !boost.isActive) {
                boost.isActive = true;
                boost.usedToday++;
                boost.lastUsedDate = today;
                gameState.tapPower *= 2; // Збільшуємо дохід за клік
                gameState.stats.multitapUsed++;
                showPopupMessage("MULTITAP PROTOCOL ACTIVE! OUTPUT DOUBLED!");
                updateDisplay();
                saveGameState();

                // Деактивація через 1 хвилину (60 секунд)
                boost.timer = setTimeout(() => {
                    boost.isActive = false;
                    gameState.tapPower /= 2; // Повертаємо дохід за клік
                    showPopupMessage("MULTITAP PROTOCOL DEACTIVATED.");
                    updateDisplay();
                    saveGameState();
                }, 60 * 1000);
            } else if (boost.isActive) {
                showPopupMessage("MULTITAP PROTOCOL ALREADY ACTIVE!");
            } else {
                showPopupMessage("DAILY MULTITAP LIMIT REACHED!");
            }
        });

        energyLimitBoostBtn.addEventListener('click', () => {
            const boost = gameState.boosts.energyLimit;
            const today = new Date();
            if (boost.usedToday < boost.dailyLimit && !boost.isActive) {
                boost.isActive = true;
                boost.usedToday++;
                boost.lastUsedDate = today;
                gameState.maxEnergy += 500; // Збільшуємо ліміт енергії
                gameState.currentEnergy = gameState.maxEnergy; // Поповнюємо енергію до нового ліміту
                gameState.stats.energyLimitUsed++;
                showPopupMessage("ENERGY CORE CAPACITY INCREASED BY 500!");
                updateDisplay();
                saveGameState();

                // Деактивація через 5 хвилин (300 секунд)
                boost.timer = setTimeout(() => {
                    boost.isActive = false;
                    gameState.maxEnergy -= 500; // Повертаємо ліміт енергії
                    if (gameState.currentEnergy > gameState.maxEnergy) {
                        gameState.currentEnergy = gameState.maxEnergy; // Якщо енергія перевищує новий ліміт, зменшуємо її
                    }
                    showPopupMessage("ENERGY CORE OVERLOAD DEACTIVATED.");
                    updateDisplay();
                    saveGameState();
                }, 5 * 60 * 1000);
            } else if (boost.isActive) {
                showPopupMessage("ENERGY CORE OVERLOAD ALREADY ACTIVE!");
            } else {
                showPopupMessage("DAILY OVERLOAD LIMIT REACHED!");
            }
        });

        // --- Управління секціями ---
        const controlButtons = document.querySelectorAll('.control-button');
        const contentSections = document.querySelectorAll('.content-section');

        controlButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                e.preventDefault();
                const targetSectionId = button.dataset.section;

                controlButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                contentSections.forEach(section => {
                    if (section.id === targetSectionId) {
                        section.classList.add('active');
                    } else {
                        section.classList.remove('active');
                    }
                });

                // Оновлюємо статистику при переході на вкладку "Статистика"
                if (targetSectionId === 'stats-section') {
                    updateStatsDisplay();
                }
            });
        });

        function updateStatsDisplay() {
            statsBalance.textContent = formatNumber(gameState.coinBalance);
            statsTapPower.textContent = formatNumber(gameState.tapPower);
            statsProfitHour.textContent = formatNumber(gameState.profitPerHour);
            statsEnergy.textContent = Math.floor(gameState.currentEnergy);
            statsMaxEnergy.textContent = gameState.maxEnergy;
            statsFullEnergyUsed.textContent = gameState.stats.fullEnergyUsed;
            statsMultitapUsed.textContent = gameState.stats.multitapUsed;
            statsEnergyLimitUsed.textContent = gameState.stats.energyLimitUsed;
        }

        // --- Поп-ап повідомлення ---
        let popupTimeout;
        function showPopupMessage(message, duration = 2000) {
            clearTimeout(popupTimeout);
            popupMessage.textContent = message;
            popupMessage.classList.add('show');
            popupTimeout = setTimeout(() => {
                popupMessage.classList.remove('show');
            }, duration);
        }

        // Ініціалізація
        loadGameState();
    </script>
</body>
</html>